<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nuôi Pet</title>
  <style>
    body {
      font-family: 'Arial';
      background: #111;
      color: white;
      text-align: center;
      padding: 20px;
    }
    #pet {
      font-size: 64px;
      margin: 20px;
    }
    .bar {
      width: 80%;
      height: 20px;
      background: #555;
      margin: 10px auto;
      border-radius: 10px;
      overflow: hidden;
    }
    .fill {
      height: 100%;
      background: lime;
      width: 0%;
    }
    .btn {
      padding: 10px 20px;
      background: #222;
      border: 1px solid #888;
      color: white;
      cursor: pointer;
      margin: 5px;
    }
    .btn:hover {
      background: #444;
    }
    .timer {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>🐾 Thú Cưng Gen 🧬</h1>
  <div id="pet">🐣</div>
  <div>Cấp độ: <span id="level">1</span></div>
  <div>Kinh nghiệm: <span id="exp">0</span></div>
  <div class="bar"><div id="expBar" class="fill"></div></div>
  <div>🥩 Thức ăn: <span id="food">5</span></div>
  <div>💬 Tương tác: <span id="interact">30</span></div><button class="btn" onclick="doFeed()">🍖 Cho ăn (+5 exp)</button> <button class="btn" onclick="doInteract()">🗣️ Tương tác (+1 exp)</button>

  <div class="timer">
    ⏳ +1 tương tác sau: <span id="countdown">30</span> giây<br>
    🕒 +10 thức ăn sau: <span id="food60Timer">3600</span> giây
  </div>  <div style="margin-top: 15px">
    <input type="text" id="codeInput" placeholder="Nhập mã nhận quà" />
    <button class="btn" onclick="redeemCode()">🎁 Nhận</button>
  </div>  <h3>Lịch sử gen</h3>
  <div id="history"></div><script>
  const petEl = document.getElementById("pet");
  const levelEl = document.getElementById("level");
  const expEl = document.getElementById("exp");
  const expBar = document.getElementById("expBar");
  const historyEl = document.getElementById("history");
  const foodEl = document.getElementById("food");
  const interactEl = document.getElementById("interact");
  const countdownEl = document.getElementById("countdown");
  const food60TimerEl = document.getElementById("food60Timer");

  const emojis = ["🐣", "🐥", "🐤", "🐔", "🦄", "🐲", "🦖", "👾", "🐉", "🧬"];
  const colors = ["red", "yellow", "lime", "cyan", "violet", "orange", "white"];

  let level = 1;
  let exp = 0;
  let food = 5;
  let interact = 30;
  let timer = 30;
  let food60Timer = 3600;
  let genHistory = [];
  let canLevelUp = true;

  function expToNextLevel(lv) {
    if (lv <= 10) return 10;
    if (lv <= 30) return 50;
    return 100;
  }

  function updateUI() {
    levelEl.textContent = level;
    expEl.textContent = exp;
    foodEl.textContent = food;
    interactEl.textContent = interact;
    countdownEl.textContent = timer;
    food60TimerEl.textContent = food60Timer;
    const maxExp = expToNextLevel(level);
    expBar.style.width = `${Math.min(100, Math.min(exp, maxExp) / maxExp * 100)}%`;
  }

  function mutatePet() {
    const emoji = emojis[Math.floor(Math.random() * emojis.length)];
    const color = colors[Math.floor(Math.random() * colors.length)];
    petEl.textContent = emoji;
    petEl.style.color = color;
    genHistory.push(`Cấp ${level}: ${emoji} (${color})`);
    renderHistory();
  }

  function renderHistory() {
    historyEl.innerHTML = genHistory.slice(-20).map(g => `<div>${g}</div>`).join('');
  }

  function gainExp(amount) {
    exp += amount;
    while (canLevelUp && exp >= expToNextLevel(level) && level < 100) {
      exp -= expToNextLevel(level);
      level++;
      mutatePet();
      canLevelUp = false;
      setTimeout(() => {
        canLevelUp = true;
        tryAutoLevel();
      }, 30000);
    }
    updateUI();
    saveData();
  }

  function tryAutoLevel() {
    if (exp >= expToNextLevel(level) && level < 100) {
      gainExp(0);
    }
  }

  function doInteract() {
    if (interact > 0) {
      interact--;
      gainExp(1);
      updateUI();
    }
  }

  function doFeed() {
    if (food > 0) {
      food--;
      gainExp(5);
      updateUI();
    }
  }

  function redeemCode() {
    const input = document.getElementById("codeInput").value.trim().toUpperCase();
    if (input === "THEMFOOD100") {
      food += 100;
      alert("✅ Nhận thành công 100 thức ăn!");
    } else if (input === "THEMTG30") {
      interact += 30;
      alert("✅ Nhận thêm 30 tương tác!");
    } else {
      alert("❌ Mã không hợp lệ!");
    }
    updateUI();
    saveData();
  }

  function saveData() {
    localStorage.setItem("genPetData", JSON.stringify({ level, exp, food, interact, genHistory }));
  }

  function loadData() {
    const data = JSON.parse(localStorage.getItem("genPetData"));
    if (data) {
      level = data.level;
      exp = data.exp;
      food = data.food ?? 5;
      interact = data.interact ?? 30;
      genHistory = data.genHistory || [];
    }
    updateUI();
    renderHistory();
  }

  loadData();
  updateUI();

  setInterval(() => {
    timer--;
    food60Timer--;
    if (timer <= 0) {
      if (interact < 99) interact++;
      timer = 30;
    }
    if (food60Timer <= 0) {
      if (food < 99) food += 10;
      food60Timer = 3600;
    }
    updateUI();
    saveData();
  }, 1000);
</script></body>
</html>